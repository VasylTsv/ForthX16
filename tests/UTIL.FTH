( THE ANS/FORTH 2012 TEST SUITE IS BEING MODIFIED SO THAT THE TEST PROGRAMS  )( FOR THE OPTIONAL WORD SETS ONLY USE STANDARD WORDS FROM THE CORE WORD SET. )( THIS FILE, WHICH IS INCLUDED *AFTER* THE CORE TEST PROGRAMS, CONTAINS      )( VARIOUS DEFINITIONS FOR USE BY THE OPTIONAL WORD SET TEST PROGRAMS TO      )( REMOVE ANY DEPENDENCIES BETWEEN WORD SETS.                                 )DECIMAL( FIRST A DEFINITION TO SEE IF A WORD IS ALREADY DEFINED. NOTE THAT          )( [DEFINED] [IF] [ELSE] AND [THEN] ARE IN THE OPTIONAL PROGRAMMING TOOLS     )( WORD SET.                                                                  )VARIABLE (\?) 0 (\?) !     ( FLAG: WORD DEFINED = 0 | WORD UNDEFINED = -1 )( [?DEF]  FOLLOWED BY [?IF] CANNOT BE USED AGAIN UNTIL AFTER [THEN] ): [?DEF]  ( "NAME" -- )   BL WORD FIND SWAP DROP 0= (\?) !;\ TEST [?DEF]T{ 0 (\?) ! [?DEF] ?DEFTEST1 (\?) @ -> -1 }T: ?DEFTEST1 1 ;T{ -1 (\?) ! [?DEF] ?DEFTEST1 (\?) @ -> 0 }T: [?UNDEF] [?DEF] (\?) @ 0= (\?) ! ;\ EQUIVALENTS OF [IF] [ELSE] [THEN], THESE MUST NOT BE NESTED: [?IF]  ( F -- )  (\?) ! ; IMMEDIATE: [?ELSE]  ( -- )  (\?) @ 0= (\?) ! ; IMMEDIATE: [?THEN]  ( -- )  0 (\?) ! ; IMMEDIATE( A CONDITIONAL COMMENT AND \ WILL BE DEFINED. NOTE THAT THESE DEFINITIONS )( ARE INADEQUATE FOR USE IN FORTH BLOCKS. IF NEEDED IN THE BLOCKS TEST     )( PROGRAM THEY WILL NEED TO BE MODIFIED HERE OR REDEFINED THERE )( \? IS A CONDITIONAL COMMENT ): \?  ( "..." -- )  (\?) @ IF EXIT THEN SOURCE >IN ! DROP ; IMMEDIATE\ TEST \?T{ [?DEF] ?DEFTEST1 \? : ?DEFTEST1 2 ;    \ SHOULD NOT BE REDEFINED          ?DEFTEST1 -> 1 }TT{ [?DEF] ?DEFTEST2 \? : ?DEFTEST1 2 ;    \ SHOULD BE REDEFINED          ?DEFTEST1 -> 2 }T[?DEF] TRUE  \? -1 CONSTANT TRUE[?DEF] FALSE \?  0 CONSTANT FALSE[?DEF] NIP   \?  : NIP SWAP DROP ;[?DEF] TUCK  \?  : TUCK SWAP OVER ;[?DEF] PARSE\? : BUMP  ( CADDR U N -- CADDR+N U-N )\?    TUCK - >R CHARS + R>\? ;\? : PARSE  ( CH "CCC<CH>" -- CADDR U )\?    >R SOURCE >IN @ BUMP\?    OVER R> SWAP >R >R         ( -- START U1 ) ( R: -- START CH )\?    BEGIN\?       DUP\?    WHILE\?       OVER C@ R@ = 0=\?    WHILE\?       1 BUMP\?    REPEAT\?       1-                      ( END U2 )  \ DELIMITER FOUND\?    THEN\?    SOURCE NIP SWAP - >IN !    ( -- END )\?    R> DROP R>                 ( -- END START )\?    TUCK - 1 CHARS /           ( -- START U )\? ;[?DEF] .(  \? : .(  [CHAR] ) PARSE TYPE ; IMMEDIATE\ S=  TO COMPARE (CASE SENSITIVE) TWO STRINGS TO AVOID USE OF COMPARE FROM\ THE STRING WORD SET. IT IS DEFINED IN CORE.FR AND CONDITIONALLY DEFINED\ HERE IF CORE.FR HAS NOT BEEN INCLUDED BY THE USER[?DEF] S=\? : S=  ( CADDR1 U1 CADDR2 U2 -- F )   \ F = TRUE IF STRINGS ARE EQUAL\?    ROT OVER = 0= IF DROP 2DROP FALSE EXIT THEN\?    DUP 0= IF DROP 2DROP TRUE EXIT THEN \?    0 DO\?         OVER C@ OVER C@ = 0= IF 2DROP FALSE UNLOOP EXIT THEN\?         CHAR+ SWAP CHAR+\?      LOOP 2DROP TRUE\? ;\ BUFFER FOR STRINGS IN INTERPRETIVE MODE SINCE S" ONLY VALID IN COMPILATION\ MODE WHEN FILE-ACCESS WORD SET IS DEFINED64 CONSTANT SBUF-SIZECREATE SBUF1 SBUF-SIZE CHARS ALLOTCREATE SBUF2 SBUF-SIZE CHARS ALLOT\ ($") SAVES A COUNTED STRING AT (CADDR): ($")  ( CADDR "CCC" -- CADDR' U )   [CHAR] " PARSE ROT 2DUP C!       ( -- CA2 U2 CA)   CHAR+ SWAP 2DUP 2>R CHARS MOVE   ( -- )  ( R: -- CA' U2 )   2R>;: $"   ( "CCC" -- CADDR U )  SBUF1 ($") ;: $2"  ( "CCC" -- CADDR U )  SBUF2 ($") ;: $CLEAR  ( CADDR -- ) SBUF-SIZE BL FILL ;: CLEAR-SBUFS  ( -- )  SBUF1 $CLEAR SBUF2 $CLEAR ;\ MORE DEFINITIONS IN CORE.FR USED IN OTHER TEST PROGRAMS, CONDITIONALLY\ DEFINED HERE IF CORE.FR HAS NOT BEEN LOADED[?DEF] MAX-UINT   \? 0 INVERT                 CONSTANT MAX-UINT[?DEF] MAX-INT    \? 0 INVERT 1 RSHIFT        CONSTANT MAX-INT[?DEF] MIN-INT    \? 0 INVERT 1 RSHIFT INVERT CONSTANT MIN-INT[?DEF] MID-UINT   \? 0 INVERT 1 RSHIFT        CONSTANT MID-UINT[?DEF] MID-UINT+1 \? 0 INVERT 1 RSHIFT INVERT CONSTANT MID-UINT+1[?DEF] 2CONSTANT \? : 2CONSTANT  CREATE , , DOES> 2@ ;BASE @ 2 BASE ! -1 0 <# #S #> SWAP DROP CONSTANT BITS/CELL BASE !\ ------------------------------------------------------------------------------\ TESTS: STR1  S" ABCD" ;  : STR2  S" ABCDE" ;: STR3  S" ABCD" ;  : STR4  S" WBCD"  ;: S"" S" " ;T{ STR1 2DUP S= -> TRUE }TT{ STR2 2DUP S= -> TRUE }TT{ S""  2DUP S= -> TRUE }TT{ STR1 STR2 S= -> FALSE }T\ T{ STR1 STR3 S= -> FALSE }TT{ STR1 STR4 S= -> FALSE }TT{ CLEAR-SBUFS -> }TT{ $" ABCDEFGHIJKLM"  SBUF1 COUNT S= -> TRUE  }TT{ $" NOPQRSTUVWXYZ"  SBUF2 OVER  S= -> FALSE }TT{ $2" ABCDEFGHIJKLM" SBUF1 COUNT S= -> FALSE }TT{ $2" NOPQRSTUVWXYZ" SBUF1 COUNT S= -> TRUE  }T\ ------------------------------------------------------------------------------CR $" TEST UTILITIES LOADED" TYPE CR